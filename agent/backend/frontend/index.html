<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blismos Chatbot</title>

<style>
/* FIX: Sample questions visibility in Light Mode */
.light-mode .sample-title { color: #334155; opacity: 1; }
.light-mode .sample-btn { background: #e5e7eb; color: #0f172a; opacity: 1; }
.light-mode .sample-btn:hover { background: #d1d5db; }

/* Light Mode */
.light-mode { background: rgba(248, 250, 252, 0.95); color: #0f172a; }
.light-mode .chat-header { background: #e0e7ff; color: #0f172a; }
.light-mode .chat-body { background: #f8fafc; }
.light-mode .bot { background: #e5e7eb; color: #0f172a; }
.light-mode .user { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
.light-mode .chat-footer { background: #e0e7ff; }

/* Theme Switch Button */
.theme-toggle { cursor: pointer; font-size: 18px; margin-left: 10px; }

body { margin: 0; font-family: "Segoe UI", sans-serif; height: 100vh; }

/* Floating button */
.chatbot-icon {
  position: fixed; bottom: 20px; right: 20px; width: 80px; height: 80px;
  background: linear-gradient(135deg, #4f46e5, #6366f1);
  border-radius: 50%; display: flex; justify-content: center; align-items: center;
  font-size: 28px; color: white; cursor: pointer; box-shadow: 0 8px 20px rgba(0,0,0,0.4); z-index: 1000;
}

/* Chat Window */
.chat-container {
  position: fixed; bottom: 100px; right: 20px; width: 380px; height: 520px;
  display: none; flex-direction: column; border-radius: 20px;
  background: rgba(15, 23, 42, 0.75); backdrop-filter: blur(14px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.5); color: white; overflow: hidden;
}

/* Header */
.chat-header { display: flex; align-items: center; gap: 12px; padding: 16px; background: rgba(0,0,0,0.25); }
.bot-avatar { width: 42px; height: 42px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #a5b4fc); display: flex; justify-content: center; align-items: center; font-size: 22px; }
.header-text { flex: 1; }
.header-text h4 { margin: 0; font-size: 16px; }
.header-text p { margin: 0; font-size: 12px; opacity: 0.8; }
.close-btn, .reset-btn { cursor: pointer; font-size: 18px; }

/* Body */
.chat-body { flex: 1; padding: 14px; overflow-y: auto; }
.sample-title { font-size: 13px; opacity: 0.8; margin-bottom: 8px; }
.sample-btn {
  background: rgba(255,255,255,0.12); padding: 10px 12px; border-radius: 12px; margin-bottom: 8px;
  font-size: 13px; cursor: pointer; transition: 0.3s; max-width: 70%; width: fit-content;
}
.sample-btn:hover { background: rgba(255,255,255,0.2); }

/* Messages */
.message { max-width: 75%; padding: 10px 14px; border-radius: 14px; font-size: 14px; margin-bottom: 10px; }
.user { margin-left: auto; background: linear-gradient(135deg, #6366f1, #4f46e5); max-width: 70%; width: fit-content; }
.bot { background: rgba(255,255,255,0.15); max-width: 70%; width: fit-content; }

/* Footer */
.chat-footer { display: flex; align-items: center; gap: 10px; padding: 14px; background: rgba(0,0,0,0.3); }
.chat-footer input { flex: 1; padding: 12px 16px; border-radius: 25px; border: none; outline: none; font-size: 14px; }
.send-btn { width: 42px; height: 42px; border-radius: 50%; background: #6366f1; border: none; color: white; font-size: 18px; cursor: pointer; }
.send-btn:hover { background: #4f46e5; }

/* Greeting Bubble beside bot icon */
.bot-greeting {
  position: fixed; bottom: 55px; right: 100px; background: white; color: #0f172a;
  padding: 10px 14px; border-radius: 14px; font-size: 19px; box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  animation: slideIn 0.6s ease; z-index: 999;
}
.bot-greeting::after {
  content: ""; position: absolute; right: -6px; bottom: 14px; width: 12px; height: 12px; background: white; transform: rotate(45deg);
}
@keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
</style>
</head>

<body>

<!-- Chat Window -->
<div class="chat-container" id="chatContainer">

  <div class="chat-header">
    <div class="bot-avatar">
         <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Lucky" alt="Bot Avatar">
    </div>
    <div class="header-text">
      <h4>Hello! How can I assist you today?</h4>
      <p>Blismos Virtual Assistant</p>
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
      <div class="theme-toggle" onclick="toggleTheme()">üåô</div>
      <div class="close-btn" onclick="toggleChat()">‚úñ</div>
    </div>
  </div>

  <div class="chat-body" id="chatBody">
    <div class="sample-title">Sample Questions:</div>
    <div class="sample-btn" onclick="quickSend('List Courses?')">üìå List Courses?</div>
    <div class="sample-btn" onclick="quickSend('Register on Blismos Academy?')">üìù Register on Blismos Academy?</div>
    <div class="sample-btn" onclick="quickSend('Contact Details?')">üìû Contact Details?</div>
  </div>

  <div class="chat-footer">
    <input id="userInput" placeholder="Type your message..." />
    <button class="send-btn" onclick="sendMessage()">‚û§</button>
  </div>
</div>

<div class="bot-greeting" id="botGreeting">Hey üëã How can I help you</div>

<!-- Floating Button -->
<div class="chatbot-icon" onclick="toggleChat()">üí¨</div>

<script>
const chatContainer = document.getElementById("chatContainer");
const input = document.getElementById("userInput");
const chatBody = document.getElementById("chatBody");

let isDark = true;

// Toggle chat window
function toggleChat() {
  const isOpen = chatContainer.style.display === "flex";

  if (isOpen) {
    // Reset memory on chat close
    fetch("http://127.0.0.1:8000/reset_memory", { method: "POST" });
  }

  chatContainer.style.display = isOpen ? "none" : "flex";
  document.getElementById("botGreeting").style.display = "none";
}

// Toggle theme
function toggleTheme() {
  isDark = !isDark;
  chatContainer.classList.toggle("light-mode");
  document.querySelector(".theme-toggle").innerText = isDark ? "üåô" : "‚òÄÔ∏è";
}

// Send quick sample messages
function quickSend(text) {
  input.value = text;
  sendMessage();
}

// Send user message
async function sendMessage() {
  const message = input.value.trim();
  if (!message) return;

  addMessage(message, "user");
  input.value = "";

  const response = await fetch("http://127.0.0.1:8000/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message })
  });

  const data = await response.json();
  addMessage(data.reply, "bot");
}

// Display messages
function addMessage(text, sender) {
  const msg = document.createElement("div");
  msg.className = `message ${sender}`;
  msg.innerText = text;
  chatBody.appendChild(msg);
  chatBody.scrollTop = chatBody.scrollHeight;
}

// Reset memory when page reload or close
window.addEventListener("beforeunload", () => {
  fetch("http://127.0.0.1:8000/reset_memory", { method: "POST" });
});

// Press enter to send message
input.addEventListener("keypress", function (e) {
  if (e.key === "Enter") sendMessage();
});
</script>

</body>
</html>
